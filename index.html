<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ® DesafÃ­o EstadÃ­stico: Muestreo y Confianza</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gradient-to-b from-blue-50 to-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-6">

  <div id="game" class="bg-white shadow-2xl rounded-2xl p-8 max-w-2xl w-full text-center border border-gray-200">
    <h1 class="text-3xl font-bold mb-6 text-blue-700">ğŸ“Š DesafÃ­o EstadÃ­stico: Muestreo y Confianza</h1>

    <!-- INTRO -->
    <div id="intro">
      <p class="mb-4 text-lg">Pon a prueba tus conocimientos sobre muestreo, poblaciÃ³n e intervalos de confianza. Â¡Responde correctamente, gana puntos y domina los cÃ¡lculos!</p>
      <button id="startBtn" class="bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700 transition">Comenzar</button>
    </div>

    <!-- QUIZ -->
    <div id="quiz" class="hidden">
      <div class="flex justify-between items-center mb-4">
        <div class="w-3/4 bg-gray-200 rounded-full h-3">
          <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width:0%"></div>
        </div>
        <div id="timer" class="text-sm font-semibold text-red-600">â±ï¸ 20s</div>
      </div>

      <h2 id="question" class="text-xl font-semibold mb-4"></h2>
      <div id="options" class="space-y-2 mb-4"></div>
      <button onclick="nextQuestion()" id="nextBtn" class="hidden bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Siguiente</button>
      <p id="feedbackQuiz" class="mt-2 font-semibold"></p>
    </div>

    <!-- PRACTICE -->
    <div id="practice" class="hidden">
      <h2 class="text-2xl font-semibold mb-4 text-blue-700">ğŸ§® Ejercicios PrÃ¡cticos</h2>
      <p class="mb-6">Resuelve los siguientes ejercicios escribiendo el resultado final de la fÃ³rmula.</p>

      <!-- Ejercicio 1 -->
      <div class="bg-gray-100 p-4 rounded-xl mb-6">
        <h3 class="font-semibold mb-2">1ï¸âƒ£ TamaÃ±o de muestra</h3>
        <p class="text-sm mb-2">Datos: N = 2000, p = 0.5, Z = 1.96, E = 0.05</p>
        <p class="text-sm mb-4 italic">FÃ³rmula: n = (ZÂ² Ã— p Ã— q Ã— N) / (EÂ² Ã— (N âˆ’ 1) + ZÂ² Ã— p Ã— q)</p>
        <input id="respuesta1" type="number" placeholder="Escribe el valor de n" class="p-2 border rounded w-full mb-2">
        <button onclick="checkSampleAnswer(1)" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Comprobar</button>
        <p id="feedback1" class="mt-2 font-semibold"></p>
      </div>

      <!-- Ejercicio 2 -->
      <div class="bg-gray-100 p-4 rounded-xl mb-6">
        <h3 class="font-semibold mb-2">2ï¸âƒ£ Intervalo de confianza (total)</h3>
        <p class="text-sm mb-2">Datos: p = 0.6, n = 100, Z = 1.96</p>
        <p class="text-sm mb-4 italic">FÃ³rmula (IC total): IC = 2 Ã— Z Ã— âˆš(p(1âˆ’p)/n)</p>
        <input id="respuestaIC" type="number" step="0.001" placeholder="Escribe el valor del intervalo de confianza total" class="p-2 border rounded w-full mb-2">
        <button onclick="checkICAnswer()" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Comprobar</button>
        <p id="feedbackIC" class="mt-2 font-semibold"></p>
      </div>

      <!-- Ejercicio 3 -->
      <div class="bg-gray-100 p-4 rounded-xl mb-6">
        <h3 class="font-semibold mb-2">3ï¸âƒ£ Muestreo - Error permitido</h3>
        <p class="text-sm mb-2">Datos: N = 1500, p = 0.4, Z = 1.96, E = 0.04</p>
        <p class="text-sm mb-4 italic">FÃ³rmula: n = (ZÂ² Ã— p Ã— q Ã— N) / (EÂ² Ã— (N âˆ’ 1) + ZÂ² Ã— p Ã— q)</p>
        <input id="respuesta2" type="number" placeholder="Escribe el valor de n" class="p-2 border rounded w-full mb-2">
        <button onclick="checkSampleAnswer(2)" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Comprobar</button>
        <p id="feedback2" class="mt-2 font-semibold"></p>
      </div>

      <!-- Ejercicio 4 -->
      <div class="bg-gray-100 p-4 rounded-xl mb-6">
        <h3 class="font-semibold mb-2">4ï¸âƒ£ Muestreo - PrecisiÃ³n del 3%</h3>
        <p class="text-sm mb-2">Datos: N = 5000, p = 0.7, Z = 1.96, E = 0.03</p>
        <p class="text-sm mb-4 italic">FÃ³rmula: n = (ZÂ² Ã— p Ã— q Ã— N) / (EÂ² Ã— (N âˆ’ 1) + ZÂ² Ã— p Ã— q)</p>
        <input id="respuesta3" type="number" placeholder="Escribe el valor de n" class="p-2 border rounded w-full mb-2">
        <button onclick="checkSampleAnswer(3)" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Comprobar</button>
        <p id="feedback3" class="mt-2 font-semibold"></p>
      </div>

      <!-- Ejercicio 5 -->
      <div class="bg-gray-100 p-4 rounded-xl mb-6">
        <h3 class="font-semibold mb-2">5ï¸âƒ£ Muestreo - PoblaciÃ³n pequeÃ±a</h3>
        <p class="text-sm mb-2">Datos: N = 500, p = 0.5, Z = 1.96, E = 0.05</p>
        <p class="text-sm mb-4 italic">FÃ³rmula: n = (ZÂ² Ã— p Ã— q Ã— N) / (EÂ² Ã— (N âˆ’ 1) + ZÂ² Ã— p Ã— q)</p>
        <input id="respuesta4" type="number" placeholder="Escribe el valor de n" class="p-2 border rounded w-full mb-2">
        <button onclick="checkSampleAnswer(4)" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Comprobar</button>
        <p id="feedback4" class="mt-2 font-semibold"></p>
      </div>

      <!-- Ejercicio 6 -->
      <div class="bg-gray-100 p-4 rounded-xl mb-6">
        <h3 class="font-semibold mb-2">6ï¸âƒ£ Muestreo - Alta variabilidad</h3>
        <p class="text-sm mb-2">Datos: N = 10000, p = 0.8, Z = 1.96, E = 0.02</p>
        <p class="text-sm mb-4 italic">FÃ³rmula: n = (ZÂ² Ã— p Ã— q Ã— N) / (EÂ² Ã— (N âˆ’ 1) + ZÂ² Ã— p Ã— q)</p>
        <input id="respuesta5" type="number" placeholder="Escribe el valor de n" class="p-2 border rounded w-full mb-2">
        <button onclick="checkSampleAnswer(5)" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition">Comprobar</button>
        <p id="feedback5" class="mt-2 font-semibold"></p>
      </div>

      <button onclick="endGame()" class="bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700 transition">Finalizar</button>
    </div>

    <!-- RESULTADOS -->
    <div id="result" class="hidden">
      <h2 class="text-2xl font-bold mb-4">ğŸ Resultados Finales</h2>
      <p id="score" class="text-lg mb-4"></p>
      <canvas id="chart" class="mb-6"></canvas>
      <a id="shareLink" href="#" target="_blank" class="text-blue-600 underline mb-4 block">ğŸ“¤ Compartir en Facebook</a>
      <button onclick="restartGame()" class="bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700 transition">Jugar de nuevo</button>
    </div>
  </div>

  <script>
    // Preguntas del quiz
    const questions = [
      { question: 'Â¿QuÃ© diferencia principal existe entre censo y muestreo?', options: ['El censo estudia solo una parte de la poblaciÃ³n','El muestreo abarca toda la poblaciÃ³n','El censo analiza a todos los individuos, el muestreo solo una parte'], answer: 2 },
      { question: 'En un estudio con 2000 pacientes, si se eligen 200 al azar, el mÃ©todo usado es:', options: ['Muestreo aleatorio simple','Muestreo sistemÃ¡tico','Muestreo por conglomerados'], answer: 0 },
      { question: 'Â¿QuÃ© representa el nivel de confianza en un intervalo?', options: ['El porcentaje de personas encuestadas','El grado de seguridad de que el intervalo contiene el valor real','El tamaÃ±o total de la poblaciÃ³n'], answer: 1 },
      { question: 'Â¿QuÃ© ocurre si el tamaÃ±o de la muestra aumenta?', options: ['El intervalo de confianza se amplÃ­a','El intervalo de confianza se estrecha','No cambia el intervalo'], answer: 1 },
      { question: 'CÃ¡lculo: si N=2000, p=0.5, Z=1.96, E=0.05, Â¿aproximadamente cuÃ¡l es el tamaÃ±o de muestra?', options: ['100','323','1000'], answer: 1 }
    ];

    let current = 0;
    let score = 0;
    let timer;
    const timePerQuestion = 20;

    // Asignar evento al botÃ³n iniciar (evita uso de onclick inline)
    document.addEventListener('DOMContentLoaded', () => {
      const startBtn = document.getElementById('startBtn');
      startBtn.addEventListener('click', startGame);
    });

    function startGame() {
      score = 0;
      current = 0;
      document.getElementById('intro').classList.add('hidden');
      document.getElementById('quiz').classList.remove('hidden');
      showQuestion();
    }

    function showQuestion() {
      const q = questions[current];
      document.getElementById('question').textContent = q.question;
      const optionsDiv = document.getElementById('options');
      const feedback = document.getElementById('feedbackQuiz');
      feedback.textContent = '';
      optionsDiv.innerHTML = '';
      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.className = 'block w-full bg-gray-200 px-4 py-2 rounded-lg hover:bg-blue-100 transition';
        btn.onclick = () => selectAnswer(i);
        optionsDiv.appendChild(btn);
      });
      updateProgress();
      startTimer();
      document.getElementById('nextBtn').classList.add('hidden');
    }

    function selectAnswer(selected) {
      clearInterval(timer);
      const q = questions[current];
      const feedback = document.getElementById('feedbackQuiz');
      const options = document.querySelectorAll('#options button');
      options.forEach((btn, i) => {
        btn.disabled = true;
        if (i === q.answer) btn.classList.add('bg-green-400');
        else if (i === selected && i !== q.answer) btn.classList.add('bg-red-400');
      });
      if (selected === q.answer) {
        score += 10;
        feedback.textContent = 'âœ… Correcto (+10 puntos)';
        feedback.classList.add('text-green-600');
      } else {
        feedback.textContent = 'âŒ Incorrecto';
        feedback.classList.add('text-red-600');
      }
      document.getElementById('nextBtn').classList.remove('hidden');
    }

    function nextQuestion() {
      current++;
      if (current < questions.length) {
        showQuestion();
      } else {
        clearInterval(timer);
        document.getElementById('quiz').classList.add('hidden');
        document.getElementById('practice').classList.remove('hidden');
      }
    }

    function updateProgress() {
      const percent = ((current) / questions.length) * 100;
      document.getElementById('progressBar').style.width = percent + '%';
    }

    function startTimer() {
      let time = timePerQuestion;
      const timerEl = document.getElementById('timer');
      timerEl.textContent = `â±ï¸ ${time}s`;
      timer = setInterval(() => {
        time--;
        timerEl.textContent = `â±ï¸ ${time}s`;
        if (time <= 0) {
          clearInterval(timer);
          timerEl.textContent = "â° Tiempo agotado";
          selectAnswer(-1);
        }
      }, 1000);
    }

    // âœ… EJERCICIOS DE MUESTREO
    function checkSampleAnswer(num) {
      const exercises = {
        1: { N: 2000, p: 0.5, Z: 1.96, E: 0.05 },
        2: { N: 1500, p: 0.4, Z: 1.96, E: 0.04 },
        3: { N: 5000, p: 0.7, Z: 1.96, E: 0.03 },
        4: { N: 500, p: 0.5, Z: 1.96, E: 0.05 },
        5: { N: 10000, p: 0.8, Z: 1.96, E: 0.02 }
      };
      const e = exercises[num];
      if (!e) return;
      const q = 1 - e.p;
      const n = (e.Z ** 2 * e.p * q * e.N) / ((e.E ** 2 * (e.N - 1)) + (e.Z ** 2 * e.p * q));
      const nCalc = Math.round(n);
      const respuesta = parseFloat(document.getElementById(`respuesta${num}`).value);
      const feedback = document.getElementById(`feedback${num}`);
      if (isNaN(respuesta)) return alert('Escribe tu respuesta.');
      const diff = Math.abs(respuesta - nCalc);
      if (diff <= 10) {
        feedback.textContent = `âœ… Correcto (+15 puntos). Valor teÃ³rico: ${nCalc}`;
        feedback.classList.remove('text-red-600');
        feedback.classList.add('text-green-600');
        score += 15;
      } else {
        feedback.textContent = `âŒ Incorrecto. Valor teÃ³rico: ${nCalc}`;
        feedback.classList.remove('text-green-600');
        feedback.classList.add('text-red-600');
      }
    }

    // âœ… INTERVALO DE CONFIANZA TOTAL (usuario ingresa solo el valor total del IC)
    function checkICAnswer() {
      const p = 0.6, n = 100, Z = 1.96;
      const respuesta = parseFloat(document.getElementById('respuestaIC').value);
      const feedback = document.getElementById('feedbackIC');
      if (isNaN(respuesta)) return alert('Escribe tu respuesta.');
      const error = Z * Math.sqrt(p * (1 - p) / n);
      const IC = parseFloat((2 * error).toFixed(3)); // intervalo total
      const diff = Math.abs(respuesta - IC);
      if (diff < 0.01) {
        feedback.textContent = `âœ… Correcto (+15 puntos). IC total: ${IC}`;
        feedback.classList.remove('text-red-600');
        feedback.classList.add('text-green-600');
        score += 15;
      } else {
        feedback.textContent = `âŒ Incorrecto. El intervalo correcto es: ${IC}`;
        feedback.classList.remove('text-green-600');
        feedback.classList.add('text-red-600');
      }
    }

    function endGame() {
      document.getElementById('practice').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('score').textContent = `PuntuaciÃ³n final: ${score} puntos`; 
      renderChart();
      const url = encodeURIComponent(window.location.href);
      document.getElementById('shareLink').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    }

    function renderChart() {
      const ctx = document.getElementById('chart');
      // destruir instancia previa si existe (evita mÃºltiples grÃ¡ficos)
      if (ctx._chartInstance) ctx._chartInstance.destroy();
      ctx._chartInstance = new Chart(ctx, {
        type: '


